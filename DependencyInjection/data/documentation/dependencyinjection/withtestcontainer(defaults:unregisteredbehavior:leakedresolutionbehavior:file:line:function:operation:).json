{"metadata":{"modules":[{"name":"DependencyInjection"}],"roleHeading":"Function","symbolKind":"func","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"withTestContainer"},{"kind":"text","text":"<"},{"kind":"genericParameter","text":"T"},{"kind":"text","text":">("},{"kind":"externalParam","text":"defaults"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"TestDefaults","preciseIdentifier":"s:19DependencyInjection12TestDefaultsV"},{"kind":"text","text":"?, "},{"kind":"externalParam","text":"unregisteredBehavior"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"UnregisteredBehavior","preciseIdentifier":"s:19DependencyInjection20UnregisteredBehaviorO"},{"kind":"text","text":", "},{"kind":"externalParam","text":"leakedResolutionBehavior"},{"kind":"text","text":": any "},{"kind":"typeIdentifier","text":"LeakedResolutionBehavior","preciseIdentifier":"s:19DependencyInjection24LeakedResolutionBehaviorP"},{"kind":"text","text":", "},{"kind":"externalParam","text":"file"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"String","preciseIdentifier":"s:SS"},{"kind":"text","text":", "},{"kind":"externalParam","text":"line"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"UInt","preciseIdentifier":"s:Su"},{"kind":"text","text":", "},{"kind":"externalParam","text":"function"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"String","preciseIdentifier":"s:SS"},{"kind":"text","text":", "},{"kind":"externalParam","text":"operation"},{"kind":"text","text":": () "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"T"},{"kind":"text","text":") "},{"kind":"keyword","text":"rethrows"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"T"}],"title":"withTestContainer(defaults:unregisteredBehavior:leakedResolutionBehavior:file:line:function:operation:)","externalID":"s:19DependencyInjection17withTestContainer8defaults20unregisteredBehavior016leakedResolutionH04file4line8function9operationxAA0D8DefaultsVSg_AA012UnregisteredH0OAA06LeakedjH0_pSSSuSSxyKXEtKlF","remoteSource":{"url":"https:\/\/github.com\/Tyler-Keith-Thompson\/DependencyInjection\/blob\/main\/Sources\/DependencyInjection\/TestContainer.swift#L398","fileName":"TestContainer.swift"},"role":"symbol"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/dependencyinjection\/withtestcontainer(defaults:unregisteredbehavior:leakedresolutionbehavior:file:line:function:operation:)"]}],"schemaVersion":{"patch":0,"minor":3,"major":0},"sections":[],"kind":"symbol","primaryContentSections":[{"kind":"declarations","declarations":[{"tokens":[{"kind":"attribute","text":"@discardableResult"},{"kind":"text","text":" "},{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"withTestContainer"},{"kind":"text","text":"<"},{"kind":"genericParameter","text":"T"},{"kind":"text","text":">("},{"kind":"externalParam","text":"defaults"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:19DependencyInjection12TestDefaultsV","text":"TestDefaults","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/TestDefaults"},{"kind":"text","text":"? = nil, "},{"kind":"externalParam","text":"unregisteredBehavior"},{"kind":"text","text":": "},{"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/UnregisteredBehavior","kind":"typeIdentifier","preciseIdentifier":"s:19DependencyInjection20UnregisteredBehaviorO","text":"UnregisteredBehavior"},{"kind":"text","text":" = .fatalError, "},{"kind":"externalParam","text":"leakedResolutionBehavior"},{"kind":"text","text":": any "},{"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/LeakedResolutionBehavior","kind":"typeIdentifier","preciseIdentifier":"s:19DependencyInjection24LeakedResolutionBehaviorP","text":"LeakedResolutionBehavior"},{"kind":"text","text":" = DefaultLeakedResolutionBehavior(), "},{"kind":"externalParam","text":"file"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"kind":"text","text":" = "},{"kind":"keyword","text":"#file"},{"kind":"text","text":", "},{"kind":"externalParam","text":"line"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:Su","text":"UInt"},{"kind":"text","text":" = "},{"kind":"keyword","text":"#line"},{"kind":"text","text":", "},{"kind":"externalParam","text":"function"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"kind":"text","text":" = "},{"kind":"keyword","text":"#function"},{"kind":"text","text":", "},{"kind":"externalParam","text":"operation"},{"kind":"text","text":": () "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"T"},{"kind":"text","text":") "},{"kind":"keyword","text":"rethrows"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"T"}],"languages":["swift"],"platforms":["macOS"]}]},{"kind":"parameters","parameters":[{"name":"defaults","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Optional "},{"type":"reference","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/TestDefaults","isActive":true},{"type":"text","text":" to pre-register in the test container."}]}]},{"name":"unregisteredBehavior","content":[{"inlineContent":[{"text":"What to do when a factory has no test double. Defaults to ","type":"text"},{"isActive":true,"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/UnregisteredBehavior\/fatalError","type":"reference"},{"text":".","type":"text"}],"type":"paragraph"}]},{"name":"leakedResolutionBehavior","content":[{"type":"paragraph","inlineContent":[{"text":"How to handle resolutions that escape the test scope. Defaults to ","type":"text"},{"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/DefaultLeakedResolutionBehavior","type":"reference","isActive":true},{"text":".","type":"text"}]}]},{"name":"file","content":[{"inlineContent":[{"text":"The file where the test container is created (for diagnostics).","type":"text"}],"type":"paragraph"}]},{"name":"line","content":[{"type":"paragraph","inlineContent":[{"text":"The line where the test container is created (for diagnostics).","type":"text"}]}]},{"name":"function","content":[{"inlineContent":[{"type":"text","text":"The function where the test container is created (for diagnostics)."}],"type":"paragraph"}]},{"name":"operation","content":[{"inlineContent":[{"type":"text","text":"The test operation to execute."}],"type":"paragraph"}]}]},{"kind":"content","content":[{"type":"heading","anchor":"return-value","level":2,"text":"Return Value"},{"inlineContent":[{"type":"text","text":"The result of the operation."}],"type":"paragraph"}]},{"kind":"content","content":[{"level":2,"anchor":"discussion","type":"heading","text":"Discussion"},{"inlineContent":[{"code":"withTestContainer","type":"codeVoice"},{"type":"text","text":" creates a child "},{"isActive":true,"type":"reference","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/Container"},{"type":"text","text":" that is completely isolated from the"},{"type":"text","text":" "},{"type":"text","text":"global default and from other concurrent tests. Any factory registrations made inside"},{"type":"text","text":" "},{"type":"text","text":"the block are scoped to this container and automatically cleaned up when the block exits."}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["@Test func myFeatureWorks() {","    withTestContainer {","        Container.logger.register { MockLogger() }","        let service = MyService()","        service.doWork()","    }","}"]},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Leak detection:"}],"type":"strong"},{"text":" When async work spawned inside the block outlives it, the","type":"text"},{"text":" ","type":"text"},{"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/LeakedResolutionBehavior","isActive":true,"type":"reference"},{"text":" is triggered. By default this crashes; set the","type":"text"},{"text":" ","type":"text"},{"type":"codeVoice","code":"DI_BEST_EFFORT_LEAK_RESOLUTION=true"},{"text":" environment variable for graceful recovery.","type":"text"}],"type":"paragraph"},{"content":[{"inlineContent":[{"type":"text","text":"Any error thrown by the operation."}],"type":"paragraph"}],"name":"Throws","type":"aside","style":"note"}]}],"hierarchy":{"paths":[["doc:\/\/DependencyInjection\/documentation\/DependencyInjection"]]},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/withTestContainer(defaults:unregisteredBehavior:leakedResolutionBehavior:file:line:function:operation:)"},"abstract":[{"type":"text","text":"Executes a synchronous test operation in an isolated container."}],"references":{"doc://DependencyInjection/documentation/DependencyInjection/TestDefaults":{"navigatorTitle":[{"text":"TestDefaults","kind":"identifier"}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"TestDefaults","kind":"identifier"}],"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/TestDefaults","abstract":[{"text":"A composable collection of ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/TestDefault"},{"text":" and\/or other ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/TestDefaults"},{"text":".","type":"text"}],"kind":"symbol","type":"topic","url":"\/documentation\/dependencyinjection\/testdefaults","title":"TestDefaults","role":"symbol"},"doc://DependencyInjection/documentation/DependencyInjection/TestDefault":{"navigatorTitle":[{"kind":"identifier","text":"TestDefault"}],"fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"TestDefault"}],"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/TestDefault","abstract":[{"type":"text","text":"A group of "},{"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/FactoryDefault","type":"reference","isActive":true},{"type":"text","text":" values that are applied together."}],"kind":"symbol","type":"topic","url":"\/documentation\/dependencyinjection\/testdefault","title":"TestDefault","role":"symbol"},"doc://DependencyInjection/documentation/DependencyInjection/LeakedResolutionBehavior":{"abstract":[{"type":"text","text":"A protocol for defining how leaked dependency resolutions are handled."}],"navigatorTitle":[{"text":"LeakedResolutionBehavior","kind":"identifier"}],"fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"LeakedResolutionBehavior","kind":"identifier"}],"kind":"symbol","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/LeakedResolutionBehavior","type":"topic","role":"symbol","title":"LeakedResolutionBehavior","url":"\/documentation\/dependencyinjection\/leakedresolutionbehavior"},"doc://DependencyInjection/documentation/DependencyInjection/withTestContainer(defaults:unregisteredBehavior:leakedResolutionBehavior:file:line:function:operation:)":{"type":"topic","kind":"symbol","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"withTestContainer","kind":"identifier"},{"text":"<","kind":"text"},{"text":"T","kind":"genericParameter"},{"text":">(","kind":"text"},{"text":"defaults","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"TestDefaults","kind":"typeIdentifier","preciseIdentifier":"s:19DependencyInjection12TestDefaultsV"},{"text":"?, ","kind":"text"},{"text":"unregisteredBehavior","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"UnregisteredBehavior","kind":"typeIdentifier","preciseIdentifier":"s:19DependencyInjection20UnregisteredBehaviorO"},{"text":", ","kind":"text"},{"text":"leakedResolutionBehavior","kind":"externalParam"},{"text":": any ","kind":"text"},{"text":"LeakedResolutionBehavior","kind":"typeIdentifier","preciseIdentifier":"s:19DependencyInjection24LeakedResolutionBehaviorP"},{"text":", ","kind":"text"},{"text":"file","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"String","kind":"typeIdentifier","preciseIdentifier":"s:SS"},{"text":", ","kind":"text"},{"text":"line","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"UInt","kind":"typeIdentifier","preciseIdentifier":"s:Su"},{"text":", ","kind":"text"},{"text":"function","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"String","kind":"typeIdentifier","preciseIdentifier":"s:SS"},{"text":", ","kind":"text"},{"text":"operation","kind":"externalParam"},{"text":": () ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"text":"T","kind":"typeIdentifier"},{"text":") ","kind":"text"},{"text":"rethrows","kind":"keyword"},{"text":" -> ","kind":"text"},{"text":"T","kind":"typeIdentifier"}],"role":"symbol","title":"withTestContainer(defaults:unregisteredBehavior:leakedResolutionBehavior:file:line:function:operation:)","url":"\/documentation\/dependencyinjection\/withtestcontainer(defaults:unregisteredbehavior:leakedresolutionbehavior:file:line:function:operation:)","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/withTestContainer(defaults:unregisteredBehavior:leakedResolutionBehavior:file:line:function:operation:)","abstract":[{"type":"text","text":"Executes a synchronous test operation in an isolated container."}]},"doc://DependencyInjection/documentation/DependencyInjection/CrashLeakedResolutionBehavior":{"type":"topic","kind":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"CrashLeakedResolutionBehavior","kind":"identifier"}],"role":"symbol","title":"CrashLeakedResolutionBehavior","url":"\/documentation\/dependencyinjection\/crashleakedresolutionbehavior","abstract":[{"type":"text","text":"A leaked resolution behavior that always crashes with a detailed error message."}],"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/CrashLeakedResolutionBehavior","navigatorTitle":[{"text":"CrashLeakedResolutionBehavior","kind":"identifier"}]},"doc://DependencyInjection/documentation/DependencyInjection/DefaultLeakedResolutionBehavior":{"navigatorTitle":[{"kind":"identifier","text":"DefaultLeakedResolutionBehavior"}],"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/DefaultLeakedResolutionBehavior","url":"\/documentation\/dependencyinjection\/defaultleakedresolutionbehavior","kind":"symbol","title":"DefaultLeakedResolutionBehavior","abstract":[{"type":"text","text":"A leaked resolution behavior that delegates to either "},{"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/BestEffortLeakedResolutionBehavior","type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"or "},{"identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/CrashLeakedResolutionBehavior","type":"reference","isActive":true},{"type":"text","text":" based on the "},{"code":"DI_BEST_EFFORT_LEAK_RESOLUTION","type":"codeVoice"},{"type":"text","text":" environment variable."}],"role":"symbol","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"DefaultLeakedResolutionBehavior"}],"type":"topic"},"doc://DependencyInjection/documentation/DependencyInjection/Container":{"type":"topic","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/Container","role":"symbol","url":"\/documentation\/dependencyinjection\/container","title":"Container","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"Container"}],"abstract":[{"type":"text","text":"The dependency resolution context."}],"navigatorTitle":[{"kind":"identifier","text":"Container"}],"kind":"symbol"},"doc://DependencyInjection/documentation/DependencyInjection/UnregisteredBehavior":{"title":"UnregisteredBehavior","kind":"symbol","role":"symbol","url":"\/documentation\/dependencyinjection\/unregisteredbehavior","fragments":[{"text":"enum","kind":"keyword"},{"text":" ","kind":"text"},{"text":"UnregisteredBehavior","kind":"identifier"}],"navigatorTitle":[{"kind":"identifier","text":"UnregisteredBehavior"}],"type":"topic","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/UnregisteredBehavior","abstract":[{"text":"Controls what happens when a dependency is resolved in a test container but has no registered test double.","type":"text"}]},"doc://DependencyInjection/documentation/DependencyInjection/UnregisteredBehavior/fatalError":{"kind":"symbol","title":"UnregisteredBehavior.fatalError","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/UnregisteredBehavior\/fatalError","abstract":[{"type":"text","text":"Crash immediately with a detailed error identifying the unregistered factory."}],"role":"symbol","type":"topic","url":"\/documentation\/dependencyinjection\/unregisteredbehavior\/fatalerror","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"fatalError","kind":"identifier"}]},"doc://DependencyInjection/documentation/DependencyInjection/BestEffortLeakedResolutionBehavior":{"type":"topic","role":"symbol","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection\/BestEffortLeakedResolutionBehavior","abstract":[{"text":"A leaked resolution behavior that attempts graceful recovery.","type":"text"}],"title":"BestEffortLeakedResolutionBehavior","kind":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"BestEffortLeakedResolutionBehavior","kind":"identifier"}],"url":"\/documentation\/dependencyinjection\/besteffortleakedresolutionbehavior","navigatorTitle":[{"text":"BestEffortLeakedResolutionBehavior","kind":"identifier"}]},"doc://DependencyInjection/documentation/DependencyInjection":{"role":"collection","identifier":"doc:\/\/DependencyInjection\/documentation\/DependencyInjection","abstract":[],"url":"\/documentation\/dependencyinjection","kind":"symbol","type":"topic","title":"DependencyInjection"}}}